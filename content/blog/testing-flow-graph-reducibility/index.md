---
title: "检测流图的可归约性"
description: ""
lead: ""
date: 2021-04-27T14:25:04+08:00
lastmod: 2021-04-27T14:25:04+08:00
draft: false
weight: 50
images: []
contributors: [szp]
---

这篇文章的主要内容来自于Tarjan的Testing Flow Graph Reducibility[^tarjan1973testing]。研究这篇文章的目的是为了得到求解归约序列的算法。依照规约序列分析可以很好的降低分析的复杂度，比如“[从CFG直接构建GSA的算法]({{< relref "/blog/build-gsa-from-cfg/index.md" >}})”中的算法。

许多程序优化和分析都涉及到interval分析。而适合这类分析的流图是可归约的。本篇文章使用深度优先搜索和并查集测试流图的可规约性。本算法的复杂度为$O(E\log^* E)$，其中$\log^*x=\min\\{i\mid\log^{(i)}x\leq 1\\}$。

## 基础概念

**引理 1** 如果$ND(v)$是树$T$某节点$v$的子孙个数。如果$T$有$V$个节点，并且通过前序标号为$1$到$V$。那么树上有路径$v\xrightarrow{\*}w$，当且仅当$v\leq w<v+ND(v)$。

这个定理给出了在前序遍历完毕后，$O(1)$复杂度判断两节点是否有祖先-子孙关系的方法。

令$(G,s)$为一流图（流图有一特殊的入口节点，且该入口节点可以到达所有节点），$T$是$G$的生成树且以$s$为根，并通过前序标号。$T$被称为深度优先生成树（DFST），如果$G$中不在$T$的边可以分为3个集合：

1. 对于$G$的边$(v,w)$在$T$中存在路径$w\xrightarrow{\*}v$，称为**循环边**；
2. 对于$G$的边$(v,w)$在$T$中存在路径$v\xrightarrow{\*}w$，称为**前向边**；
3. 对于$G$的边$(v,w)$在$T$中即不存在路径$v\xrightarrow{\*}w$也不存在路径$w\xrightarrow{\*}v$，且此时$w<v$，称为**交叉边**；

一个DFST之所以这么称呼，是因为它可以通过从$s$出发在$G$上进行深度优先遍历得到。因而可以在$O(V+E)$的时间复杂度里生成DFST、计算每个节点的序号和$ND(v)$、计算出循环边、前向边、交叉边的集合。

## 流图和可归约性

令$v$和$w\neq s$是流图$(G,s)$中的两个节点。定义一种操作“将$w$合并进$v$”，即删除$w$及其所有边，在不构成自环和重边的情况下，将$w$的边接到$v$上，构成新图$G'$。$G'$同样是流图。

如果$G'$是$G$通过几次合并操作形成的图，那么$G'$的每个节点$v'$都对应$G$中节点的集合。此外$G'$的每个边也会对应$G$的边，但反过来不一定有对应的。考虑下面的变换：

$T_2$：如果$(v,w)$是$w$唯一的入边，且$w\neq s$，将$w$合并进$v$。

一个流图如果是可归约的当且仅当不断使用$T_2$可以将流图转化为只包含$s$的图（这个定义中假定流图不包含自环）。如果$G'$由$G$通过几次$T_2$变换得到，则称$G'$是$G$的**归约**。一个唯一的图可以通过不断使用$T_2$变换得到，因此变换的顺序并不影响可归约性。

令$T$是流图$(G,s)$的一个DFST。

**定理 2 （Hecht & Ullman）** 如果$G$是可归约的当且仅当相对于$T$对于每个循环边$(v,w)$，$w$支配$v$。

[^tarjan1973testing]: Tarjan, Robert. "Testing flow graph reducibility." *Proceedings of the fifth annual ACM symposium on Theory of computing*. 1973.
